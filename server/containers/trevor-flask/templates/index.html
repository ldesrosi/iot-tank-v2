<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <title>T.R.E.V.O.R Dashboard</title>

    <link rel="stylesheet" href="/trevor/static/styles.css">

    <script src="//cdnjs.cloudflare.com/ajax/libs/three.js/r67/three.js" type="text/javascript"></script>
    <script src="//js.leapmotion.com/leap-0.6.2.js" type="text/javascript"></script>
    <script src="//js.leapmotion.com/leap-plugins-0.1.6.1.js" type="text/javascript"></script>
    <script src="//js.leapmotion.com/leap.rigged-hand-0.1.4.min.js" type="text/javascript"></script>
    <script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/socket.io/1.3.6/socket.io.min.js"></script>
  </head>

  <body>
    <div class="outer-wrap">
      <header>
        <div class="hflex-container round-borders">
            <canvas id="videoStream"></canvas>
        </div>
      </header>
      <section class="hflex-container">
        <div class="vflex-container round-borders flex-item">
          <iframe src="http://local.gateway.io:3000/dashboard-solo/db/trevor?orgId=1&refresh=5s&panelId=3&theme=light" width="450" height="200" frameborder="0" class="flex-item"></iframe>
          <iframe src="http://local.gateway.io:3000/dashboard-solo/db/trevor?orgId=1&refresh=5s&panelId=4&theme=light" width="450" height="200" frameborder="0"class="flex-item"></iframe>
          <iframe src="http://local.gateway.io:3000/dashboard-solo/db/trevor?orgId=1&refresh=5s&panelId=1&theme=light" width="450" height="200" frameborder="0" class="flex-item"></iframe>
          <iframe src="http://local.gateway.io:3000/dashboard-solo/db/trevor?orgId=1&refresh=5s&panelId=2&theme=light" width="450" height="200" frameborder="0"class="flex-item"></iframe>
        </div>
        <iframe src="/trevor/static/leap.html" class="motion-container" frameborder="0"></iframe>
      </section>
    </div>
    <script type="text/javascript">
    var isready = false;
    var connection = null;
    var serverUrl = "http://" + window.location.host + "/trevor/io";
    var canvas = document.getElementById('videoStream');
    canvas.width = 320;
    canvas.height = 240;

    function createWebSocket () {
      connection = new io.connect(serverUrl);

      connection.on('connect', function () {
        console.log("Connected");
        isready=true;
      });

      connection.on('disconnect', function () {
        console.log("Disconnected");
        isready=false;
      });

      connection.on( 'stream_output', function ( data ) {
          console.log("stream_output received");
          var img = new Image();
          img.src = data.raw;

          canvas.getContext('2d').drawImage( img, 0, 0 );
      } );
    }
    createWebSocket();
    </script>
  </body>
</html>
